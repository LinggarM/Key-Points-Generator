<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Key Points Extractor</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìù</text></svg>">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5',
                        secondary: '#818CF8',
                        accent: '#F472B6',
                        dark: '#1E293B',
                        light: '#F8FAFC'
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(79, 70, 229, 0.4);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(79, 70, 229, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(79, 70, 229, 0);
            }
        }

        .output-content li {
            margin-bottom: 0.75rem;
            padding-left: 1.75rem;
            position: relative;
        }

        .output-content li:before {
            content: "‚Ä¢";
            color: #4F46E5;
            font-size: 1.5rem;
            position: absolute;
            left: 0;
            top: -0.25rem;
        }

        /* Tooltip for copy button feedback */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 4px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            /* Position above the button */
            left: 50%;
            margin-left: -60px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        .tab-active {
            border-bottom: 3px solid #4F46E5;
            color: #4F46E5;
            font-weight: 600;
        }
    </style>
</head>

<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen py-12 px-4 sm:px-6">
    <div class="max-w-3xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-12 fade-in">
            <h1 class="text-4xl md:text-5xl font-bold leading-[1.2] pb-1 whitespace-nowrap mb-3">
                <span>üìù</span>
                <span class="bg-clip-text text-transparent bg-gradient-to-r from-primary to-accent">
                    Key Points Extractor
                </span>
            </h1>
            <p class="text-gray-600 max-w-md mx-auto">
                Transform lengthy articles into concise, actionable insights
            </p>
        </header>
        <!-- Main Card -->
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden transition-all duration-300 hover:shadow-2xl">
            <div class="p-6 sm:p-8">
                <!-- Tabs -->
                <div class="flex border-b border-gray-200 mb-6">
                    <button id="textTab" class="tab-btn tab-active px-4 py-2 font-medium text-gray-600">
                        <i class="fas fa-keyboard mr-2"></i>Paste Text
                    </button>
                    <button id="urlTab" class="tab-btn px-4 py-2 font-medium text-gray-600">
                        <i class="fas fa-link mr-2"></i>From URL
                    </button>
                </div>

                <!-- Text Input Section -->
                <div id="textSection" class="input-section">
                    <label for="userText" class="block text-lg font-medium text-gray-800 mb-3">
                        <i class="fas fa-edit mr-2 text-primary"></i>Your Article
                    </label>
                    <textarea id="userText" rows="8"
                        class="w-full px-5 py-4 text-gray-700 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-300"
                        placeholder="Paste your article here..."></textarea>
                </div>

                <!-- URL Input Section -->
                <div id="urlSection" class="input-section hidden">
                    <label for="articleUrl" class="block text-lg font-medium text-gray-800 mb-3">
                        <i class="fas fa-globe mr-2 text-primary"></i>Article URL
                    </label>
                    <div class="flex">
                        <input 
                            type="url" 
                            id="articleUrl" 
                            class="flex-grow px-5 py-4 text-gray-700 border border-gray-200 rounded-l-xl focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-300"
                            placeholder="https://example.com/article">
                        <button 
                            id="fetchUrlBtn"
                            class="bg-gray-200 hover:bg-gray-300 px-6 rounded-r-xl transition-colors">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                    <div id="fetchedContent" class="mt-4 hidden">
                        <label class="block text-lg font-medium text-gray-800 mb-3">
                            <i class="fas fa-file-lines mr-2 text-primary"></i>Fetched Content
                        </label>
                        <div class="bg-gray-50 border border-gray-200 rounded-xl p-5 max-h-60 overflow-y-auto">
                            <p id="contentPreview" class="text-gray-700"></p>
                        </div>
                    </div>
                </div>

                <!-- Button -->
                <div class="flex justify-center mt-8">
                    <button id="extractBtn"
                        class="px-8 py-4 bg-gradient-to-r from-primary to-secondary text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-300 flex items-center group pulse">
                        <i class="fas fa-bolt mr-2 group-hover:rotate-12 transition-transform"></i>
                        Extract Key Points
                    </button>
                </div>
            </div>
            <!-- Loading Indicator -->
            <div id="loading" class="hidden py-8 bg-gray-50 border-t border-gray-100 text-center">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-indigo-600">
                </div>
                <p class="mt-2 text-gray-600">Analyzing content...</p>
            </div>
            <!-- Output Section -->
            <div id="resultContainer" class="hidden border-t border-gray-100">
                <div class="p-6 sm:p-8">
                    <div class="flex items-center justify-between mb-5">
                        <div class="flex items-center">
                            <i class="fas fa-list-check text-primary text-xl mr-3"></i>
                            <h2 class="text-2xl font-bold text-gray-800">Key Insights</h2>
                        </div>
                        <!-- Copy Button -->
                        <div class="tooltip">
                            <button id="copyBtn"
                                class="px-5 py-2.5 bg-gradient-to-r from-primary to-secondary text-white font-medium rounded-lg shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-300 flex items-center group">
                                <i class="far fa-copy mr-2 group-hover:rotate-12 transition-transform"></i>
                                <span id="copyBtnText">Copy Insights</span>
                            </button>
                            <span id="copyTooltip" class="tooltiptext">Copied!</span>
                        </div>
                    </div>
                    <div id="pointsOutput"
                        class="output-content bg-gray-50 rounded-xl p-6 text-gray-700 leading-relaxed"></div>
                </div>
            </div>
            <!-- Error Section -->
            <div id="errorContainer" class="hidden py-6 px-8 bg-red-50 border-t border-red-100">
                <div class="flex items-start">
                    <i class="fas fa-exclamation-circle text-red-500 text-xl mt-0.5 mr-3"></i>
                    <div>
                        <h3 class="font-medium text-red-800">Error Processing Request</h3>
                        <p id="errorMessage" class="text-red-600 mt-1"></p>
                    </div>
                </div>
            </div>
        </div>
        <!-- Footer -->
        <footer class="mt-10 text-center text-gray-500 text-sm">
            <p>Powered by AI Technology ‚Ä¢ Extract insights in seconds</p>
        </footer>
    </div>
    <script>
        let currentKeyPoints = '';

        $(document).ready(function () {
            // Tab switching
            $('#textTab').on('click', function() {
                $('.tab-btn').removeClass('tab-active');
                $(this).addClass('tab-active');
                $('#textSection').removeClass('hidden');
                $('#urlSection').addClass('hidden');
            });
            
            $('#urlTab').on('click', function() {
                $('.tab-btn').removeClass('tab-active');
                $(this).addClass('tab-active');
                $('#urlSection').removeClass('hidden');
                $('#textSection').addClass('hidden');
            });
            
            // Fetch content from URL
            $('#fetchUrlBtn').on('click', function() {
                const url = $('#articleUrl').val().trim();
                
                if (!url) {
                    showError('Please enter a valid URL');
                    return;
                }
                
                // Show loading
                $('#loading').removeClass('hidden').addClass('fade-in');
                $('#fetchedContent').addClass('hidden');
                $('#errorContainer').addClass('hidden');
                
                // Simulate fetching content (replace with actual AJAX)
                setTimeout(() => {
                    $('#loading').addClass('hidden');
                    
                    // Sample content for demonstration
                    const sampleContent = "Artificial intelligence (AI) is transforming industries by automating complex tasks. Key applications include natural language processing, computer vision, and predictive analytics. AI systems can now understand context, generate human-like text, and identify patterns in large datasets. This technology is revolutionizing healthcare, finance, and customer service sectors. However, ethical considerations around bias, privacy, and job displacement remain critical challenges that require ongoing attention from policymakers and technologists.";
                    
                    $('#contentPreview').text(sampleContent);
                    $('#fetchedContent').removeClass('hidden').addClass('fade-in');
                }, 1500);
            });

            // Extract key points
            $('#extractBtn').on('click', function () {
                const userText = $('#userText').val().trim();
                if (!userText) {
                    showError('Please enter some text to analyze');
                    return;
                }
                // Show loading, hide previous results
                $('#loading').removeClass('hidden').addClass('fade-in');
                $('#resultContainer').addClass('hidden');
                $('#errorContainer').addClass('hidden');
                // Reset copy button state
                resetCopyButton();
                // Send request to backend
                $.ajax({
                    url: '/extract_points',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        text: userText
                    }),
                    success: function (response) {
                        currentKeyPoints = response.points;

                        $('#loading').addClass('hidden');
                        $('#pointsOutput').html(formatKeyPointsTextToHTML(response.points));
                        $('#resultContainer').removeClass('hidden').addClass('fade-in');
                    },
                    error: function (xhr) {
                        $('#loading').addClass('hidden');
                        const errorMsg = (xhr.responseJSON && xhr.responseJSON.error) ||
                            'Terjadi kesalahan tidak terduga';
                        showError(errorMsg);
                    }
                });
            });

            // Copy button functionality
            $('#copyBtn').on('click', function () {
                const outputText = currentKeyPoints;

                navigator.clipboard.writeText(outputText).then(function () {
                    $('#copyBtnText').text('Copied!');
                    $('#copyTooltip').addClass('show');

                    // Change button to "clicked" state: gray gradient look
                    $('#copyBtn')
                        .removeClass('bg-gradient-to-r from-primary to-secondary text-white')
                        .addClass('bg-gray-200 text-gray-700');

                    // Revert after 2 seconds
                    setTimeout(resetCopyButton, 2000);
                }, function (err) {
                    console.error('Failed to copy text: ', err);
                    $('#copyBtnText').text('Copy Failed');

                    $('#copyBtn')
                        .removeClass('bg-gradient-to-r from-primary to-secondary text-white')
                        .addClass('bg-red-100 text-red-800');

                    setTimeout(resetCopyButton, 2000);
                });
            });

            function resetCopyButton() {
                $('#copyBtnText').text('Copy Insights');
                $('#copyTooltip').removeClass('show');
                $('#copyBtn')
                    .removeClass('bg-gray-200 text-gray-700 bg-red-100 text-red-800')
                    .addClass('bg-gradient-to-r from-primary to-secondary text-white');
            }

            function showError(message) {
                $('#errorMessage').text(message);
                $('#errorContainer').removeClass('hidden').addClass('fade-in');
                $('#loading').addClass('hidden');
                $('#resultContainer').addClass('hidden');
            }
        });
        /**
         * Formats key points text to HTML.
         * - Converts **text** to <strong>text</strong>
         * - Converts `code` to <code>code</code>
         * - Converts numbered lists (1. item) to <ol><li>item</li></ol>
         * - Converts bullets (- item) to <div>‚Ä¢ item</div>
         * - Handles indentation for nested bullets (+ item)
         */
        function formatKeyPointsTextToHTML(text) {
            console.log(text);
            const lines = text.split('\n');
            let html = '';
            let inList = false;
            let prev_length = 0;
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                // Ganti **text** dengan <strong>text</strong>
                let formatted = line.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
                formatted = formatted.replace(/`([^`]+?)`/g, '<code>$1</code>');
                formatted = formatted.replace(/^\*\s/gm, '‚Ä¢ ');
                formatted = formatted.replace(/^\+\s(.*)$/gm, '<div style="margin-left: 15px">‚Ä¢ $1</div>');
                if (/^(?:<[^>]+>)*\d+\./.test(formatted)) {
                    if (!inList) {
                        html += '<ol>';
                        inList = true;
                    }
                    html += `<li>${formatted.replace(/^((?:\s*<[^>]+>\s*)*)(\d+\.\s*)/, '$1')}</li>`;
                } else if (/^-\s/.test(formatted) && inList) {
                    const bulletContent = formatted.replace(/^-\s*/, '');
                    html += `<div>‚Ä¢ ${bulletContent}</div>`;
                } else if (/^\+\s/.test(formatted) && inList) {
                    const bulletContent = formatted.replace(/^\+\s*/, '');
                    html += `<div style="margin-left: 15px">‚Ä¢ ${bulletContent}</div>`;
                } else if (formatted.length == 0 && inList) {
                    html += `<br/>`;
                } else if (formatted.length > 0 && inList && prev_length > 0) {
                    html += `<p>${formatted}</p>`;
                } else {
                    if (inList) {
                        html += '</ol>';
                        inList = false;
                    }
                    if (formatted.length > 0) {
                        html += `<p>${formatted}</p>`;
                    }
                    if (formatted.length == 0) {
                        html += `<br/>`;
                    }
                }
                prev_length = line.length;
            }
            if (inList) {
                html += '</ol>';
            }
            return html;
        }
    </script>
</body>

</html>